<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DSAN-5000: Project - Data Cleaning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-xxl navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">DSAN-5000: Project</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/anly501/dsan-5000-project-mfgeary" rel="" target="">
 <span class="menu-text">Code</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Data</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data">    
        <li>
    <a class="dropdown-item" href="https://github.com/anly501/dsan-5000-project-mfgeary/tree/main/dsan-website/5000-website/data/raw_data" rel="" target="">
 <span class="dropdown-text">Raw Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/anly501/dsan-5000-project-mfgeary/tree/main/dsan-website/5000-website/data" rel="" target="">
 <span class="dropdown-text">Clean Data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../introduction/introduction.html" rel="" target="">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../data-collection/data-collection.html" rel="" target="">
 <span class="menu-text">Data Gathering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../data-cleaning/data-cleaning.html" rel="" target="" aria-current="page">
 <span class="menu-text">Data Cleaning</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../eda/eda.html" rel="" target="">
 <span class="menu-text">Data Exploration</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../work-in-progress.html" rel="" target="">
 <span class="menu-text">Clustering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../work-in-progress.html" rel="" target="">
 <span class="menu-text">Dimensionality Reduction</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-decision-trees" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Decision Trees</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-decision-trees">    
        <li>
    <a class="dropdown-item" href="../work-in-progress.html" rel="" target="">
 <span class="dropdown-text">Classification</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../work-in-progress.html" rel="" target="">
 <span class="dropdown-text">Regression</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../work-in-progress.html" rel="" target="">
 <span class="menu-text">ARM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../work-in-progress.html" rel="" target="">
 <span class="menu-text">Conclusions</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#cleaning-text-data" id="toc-cleaning-text-data" class="nav-link active" data-scroll-target="#cleaning-text-data">Cleaning Text Data</a>
  <ul class="collapse">
  <li><a href="#reddit-data" id="toc-reddit-data" class="nav-link" data-scroll-target="#reddit-data">Reddit Data</a></li>
  <li><a href="#wikipedia-data" id="toc-wikipedia-data" class="nav-link" data-scroll-target="#wikipedia-data">Wikipedia Data</a></li>
  </ul></li>
  <li><a href="#record-data" id="toc-record-data" class="nav-link" data-scroll-target="#record-data">Record Data</a>
  <ul class="collapse">
  <li><a href="#cannabinoids" id="toc-cannabinoids" class="nav-link" data-scroll-target="#cannabinoids">Cannabinoids</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Cleaning</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Now that we have gathered a reasonable amount of textual and record data, we can begin the data cleaning process. Our ultimate goal is to do statistical modeling wtih our data, so we need to clean the data. Generally, we will follow the principles of tidy data <span class="citation" data-cites="tidydata">(<a href="#ref-tidydata" role="doc-biblioref">Wickham 2014</a>)</span> in cleaning our data.</p>
<section id="cleaning-text-data" class="level1">
<h1>Cleaning Text Data</h1>
<p>To begin, we will clean our textual data by parsing out the text from the JSON and HTML objects that were returned from the Reddit and Wikipedia APIs respectively.</p>
<section id="reddit-data" class="level2">
<h2 class="anchored" data-anchor-id="reddit-data">Reddit Data</h2>
<p>Recall that the Reddit data was returned as a JSON. We retrieved 10,000 text posts for each of three different text files. Our goal is to turn each of these JSON files into an individual dataframe. From there, we can transform the data into a Bag of Words, Document Term Matrix, or any other helpful format.</p>
<p>We will use <code>pandas</code> and <code>json</code> to parse this data into a desired output. First let’s read in the data.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>import pandas as pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>import json</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>with <span class="fu">open</span>(<span class="st">"../data/raw_data/reddit_psychosis_data.json"</span>) as f<span class="sc">:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    reddit_psychosis <span class="ot">=</span> <span class="fu">json.load</span>(f)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>with <span class="fu">open</span>(<span class="st">'../data/raw_data/reddit_cannabis_data.json'</span>) as f<span class="sc">:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    reddit_cannabis <span class="ot">=</span> <span class="fu">json.load</span>(f)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>with <span class="fu">open</span>(<span class="st">"../data/raw_data/reddit_schizophrenia_data.json"</span>) as f<span class="sc">:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    reddit_schizophrenia <span class="ot">=</span> <span class="fu">json.load</span>(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From the data pull, we know that each of these JSON files has 100 elements, each with 100 posts.</p>
<p>Let’s look at the structure of one element to identify how we can extract the title and text information.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>reddit_psychosis[<span class="st">'0'</span>]<span class="fu">.keys</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>dict_keys(['kind', 'data'])</code></pre>
</div>
</div>
<p>From here, we see that the posts are within the parameter <code>children</code>.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">len</span>(reddit_psychosis[<span class="st">'0'</span>][<span class="st">'data'</span>][<span class="st">'children'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dict_keys(['kind', 'data'])
100</code></pre>
</div>
</div>
<p>It looks like these are the 100 posts we’re looking for. Now we’ll extract the title and text from each of these children elements.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>reddit_psychosis[<span class="st">'0'</span>][<span class="st">'data'</span>][<span class="st">'children'</span>][<span class="dv">1</span>][<span class="st">'data'</span>]<span class="fu">.keys</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>dict_keys(['approved_at_utc', 'subreddit', 'selftext', 'author_fullname', 'saved', 'mod_reason_title', 'gilded', 'clicked', 'title', 'link_flair_richtext', 'subreddit_name_prefixed', 'hidden', 'pwls', 'link_flair_css_class', 'downs', 'thumbnail_height', 'top_awarded_type', 'hide_score', 'name', 'quarantine', 'link_flair_text_color', 'upvote_ratio', 'author_flair_background_color', 'subreddit_type', 'ups', 'total_awards_received', 'media_embed', 'thumbnail_width', 'author_flair_template_id', 'is_original_content', 'user_reports', 'secure_media', 'is_reddit_media_domain', 'is_meta', 'category', 'secure_media_embed', 'link_flair_text', 'can_mod_post', 'score', 'approved_by', 'is_created_from_ads_ui', 'author_premium', 'thumbnail', 'edited', 'author_flair_css_class', 'author_flair_richtext', 'gildings', 'post_hint', 'content_categories', 'is_self', 'mod_note', 'created', 'link_flair_type', 'wls', 'removed_by_category', 'banned_by', 'author_flair_type', 'domain', 'allow_live_comments', 'selftext_html', 'likes', 'suggested_sort', 'banned_at_utc', 'url_overridden_by_dest', 'view_count', 'archived', 'no_follow', 'is_crosspostable', 'pinned', 'over_18', 'preview', 'all_awardings', 'awarders', 'media_only', 'can_gild', 'spoiler', 'locked', 'author_flair_text', 'treatment_tags', 'visited', 'removed_by', 'num_reports', 'distinguished', 'subreddit_id', 'author_is_blocked', 'mod_reason_by', 'removal_reason', 'link_flair_background_color', 'id', 'is_robot_indexable', 'report_reasons', 'author', 'discussion_type', 'num_comments', 'send_replies', 'whitelist_status', 'contest_mode', 'mod_reports', 'author_patreon_flair', 'author_flair_text_color', 'permalink', 'parent_whitelist_status', 'stickied', 'url', 'subreddit_subscribers', 'created_utc', 'num_crossposts', 'media', 'is_video'])</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">=</span> reddit_psychosis[<span class="st">'0'</span>][<span class="st">'data'</span>][<span class="st">'children'</span>][<span class="dv">1</span>][<span class="st">'data'</span>][<span class="st">'selftext'</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>title <span class="ot">=</span> reddit_psychosis[<span class="st">'0'</span>][<span class="st">'data'</span>][<span class="st">'children'</span>][<span class="dv">0</span>][<span class="st">'data'</span>][<span class="st">'title'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we have discovered the structure of this data, we can extract the text info for all of the posts. Let’s loop through all three files to get the data in a data frame.</p>
<p>First, we can define function to loop through each of our JSON files.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>def <span class="fu">parse_reddit_json</span>(reddit_json)<span class="sc">:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    text_list <span class="ot">=</span> []</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    title_list <span class="ot">=</span> []</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    subreddit_list <span class="ot">=</span> []</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="cf">in</span> <span class="fu">range</span>(<span class="dv">0</span>, <span class="dv">100</span>)<span class="sc">:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        index <span class="ot">=</span> <span class="fu">str</span>(i)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="cf">in</span> <span class="fu">range</span>(<span class="dv">0</span>, <span class="dv">100</span>)<span class="sc">:</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">text_list.append</span>(reddit_json[index][<span class="st">'data'</span>][<span class="st">'children'</span>][j][<span class="st">'data'</span>][<span class="st">'selftext'</span>])</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">title_list.append</span>(reddit_json[index][<span class="st">'data'</span>][<span class="st">'children'</span>][j][<span class="st">'data'</span>][<span class="st">'title'</span>])</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">subreddit_list.append</span>(reddit_json[index][<span class="st">'data'</span>][<span class="st">'children'</span>][j][<span class="st">'data'</span>][<span class="st">'subreddit'</span>])</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    return text_list, title_list, subreddit_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, the function parses each of the JSON files and outputs a list of the title of each post and the text contents of each post. All posts have titles, but not all posts have additional text.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>psy_text, psy_title, psy_sub <span class="ot">=</span> <span class="fu">parse_reddit_json</span>(reddit_psychosis)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>schiz_text, schiz_title, schiz_sub <span class="ot">=</span> <span class="fu">parse_reddit_json</span>(reddit_schizophrenia)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>cannabis_text, cannabis_title, cannabis_sub <span class="ot">=</span> <span class="fu">parse_reddit_json</span>(reddit_cannabis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have these lists, we can combine them into a <code>pandas</code> dataframe where each row is one post on Reddit.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">=</span> psy_text <span class="sc">+</span> schiz_text <span class="sc">+</span> cannabis_text</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>title <span class="ot">=</span> psy_title <span class="sc">+</span> schiz_title <span class="sc">+</span> cannabis_title</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>sub <span class="ot">=</span> psy_sub <span class="sc">+</span> schiz_sub <span class="sc">+</span> cannabis_sub</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>reddit_df <span class="ot">=</span> <span class="fu">pd.DataFrame</span>({<span class="st">'text'</span><span class="sc">:</span> text, <span class="st">'title'</span><span class="sc">:</span> title, <span class="st">'subreddit'</span><span class="sc">:</span> sub})</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">reddit_df.head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">text</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">subreddit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3 years post-psychosis in recovery some days c...</td>
<td>first time smiling on camera in... 3 years!</td>
<td>Psychosis</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td></td>
<td>I quit my meds lmfao</td>
<td>Psychosis</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td></td>
<td>I hate it here</td>
<td>Psychosis</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td></td>
<td>art by me. I thought it kinda visualized how I...</td>
<td>Psychosis</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td></td>
<td>But I’m still god and this is neither a joke a...</td>
<td>Psychosis</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now we have a data frame of labeled text objects that will be easy to work with for modeling.</p>
<p>To take this data a step further, we can use a <code>spacy</code> pipeline to clean the text. This will do some standard cleaning to deal with things like emails, numbers, extra white space, and punctuation.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>reddit_df[<span class="st">'all_text'</span>] <span class="ot">=</span> reddit_df[<span class="st">'title'</span>] <span class="sc">+</span> <span class="st">" "</span> <span class="sc">+</span> reddit_df[<span class="st">'text'</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>text_list <span class="ot">=</span> <span class="fu">list</span>(reddit_df[<span class="st">'all_text'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Code adapted from DSAN 5800 Lab 2 by Dr. Larson</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>import spacy</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>pipeline <span class="ot">=</span> <span class="fu">spacy.load</span>(<span class="st">'en_core_web_sm'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>import re</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>from spacy.language import Language</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># http://emailregex.com/</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>email_re <span class="ot">=</span> r<span class="st">"""(?:[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+)*|"</span>(?<span class="sc">:</span>[\x01<span class="sc">-</span>\x08\x0b\x0c\x0e<span class="sc">-</span>\x1f\x21\x23<span class="sc">-</span>\x5b\x5d<span class="sc">-</span>\x7f]<span class="sc">|</span>\\[\x01<span class="sc">-</span>\x09\x0b\x0c\x0e<span class="sc">-</span>\x7f])<span class="sc">*</span><span class="st">")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[</span><span class="sc">\x01</span><span class="st">-</span><span class="sc">\x08\x0b\x0c\x0e</span><span class="st">-</span><span class="sc">\x1f\x21</span><span class="st">-</span><span class="sc">\x5a\x53</span><span class="st">-</span><span class="sc">\x7f</span><span class="st">]|</span><span class="sc">\\</span><span class="st">[</span><span class="sc">\x01</span><span class="st">-</span><span class="sc">\x09\x0b\x0c\x0e</span><span class="st">-</span><span class="sc">\x7f</span><span class="st">])+)\])"""</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co"># replace = [ (pattern-to-replace, replacement),  ...]</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>replace <span class="ot">=</span> [</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    (r<span class="st">"&lt;a[^&gt;]*&gt;(.*?)&lt;/a&gt;"</span>, r<span class="st">"\1"</span>),  <span class="co"># Matches most URLs</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    (email_re, <span class="st">"email"</span>),            <span class="co"># Matches emails</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    (r<span class="st">"(?&lt;=\d),(?=\d)"</span>, <span class="st">""</span>),        <span class="co"># Remove commas in numbers</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    (r<span class="st">"\d+"</span>, <span class="st">"numbr"</span>),              <span class="co"># Map digits to special token &lt;numbr&gt;</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    (r<span class="st">"[</span><span class="sc">\t\n\r</span><span class="st">\*\.\@\,\-\/]"</span>, <span class="st">" "</span>), <span class="co"># Punctuation and other junk</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    (r<span class="st">"\s+"</span>, <span class="st">" "</span>)                   <span class="co"># Strips extra whitespace</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> repl <span class="cf">in</span> replace<span class="sc">:</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    text_list <span class="ot">=</span> [<span class="fu">re.sub</span>(repl[<span class="dv">0</span>], repl[<span class="dv">1</span>], text) <span class="cf">for</span> text <span class="cf">in</span> text_list]</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span><span class="fu">Language.component</span>(<span class="st">"DSAN5000"</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>def <span class="fu">DSAN5000_preprocess</span>(doc)<span class="sc">:</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    tokens <span class="ot">=</span> [token <span class="cf">for</span> token <span class="cf">in</span> doc </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> not <span class="fu">any</span>((token.is_stop, token.is_punct))]</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    tokens <span class="ot">=</span> [<span class="fu">token.lemma_.lower</span>()<span class="fu">.strip</span>() <span class="cf">for</span> token <span class="cf">in</span> tokens]</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    tokens <span class="ot">=</span> [token <span class="cf">for</span> token <span class="cf">in</span> tokens <span class="cf">if</span> token]</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    return <span class="fu">pipeline.make_doc</span>(<span class="st">" "</span><span class="fu">.join</span>(tokens))</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="fu">pipeline.add_pipe</span>(<span class="st">"DSAN5000"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2023-10-12 21:34:10.776773: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: SSE4.1 SSE4.2 AVX AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/Users/Marion/anaconda3/envs/dsan5800/lib/python3.11/site-packages/spacy/util.py:837: UserWarning: [W095] Model 'en_core_web_sm' (3.5.0) was trained with spaCy v3.5 and may not be 100% compatible with the current version (3.3.1). If you see errors or degraded performance, download a newer compatible model or retrain your custom model with the current spaCy version. For more details and available updates, run: python -m spacy validate
  warnings.warn(warn_msg)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;function __main__.DSAN5000_preprocess(doc)&gt;</code></pre>
</div>
</div>
<p>We can use this pipeline to clean up the text data.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>text_list_clean <span class="ot">=</span> [<span class="fu">pipeline</span>(doc) <span class="cf">for</span> doc <span class="cf">in</span> text_list]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>text_list_clean[<span class="dv">0</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>[time smile camera numbr year numbr year post psychosis recovery day complete nightmare nightmare u hold long time knock grow strong find breakthrough moment lt;numbr trust friend dm support ❤ ️,
 quit med lmfao,
 hate,
 art think kinda visualize feel,
 god joke crisis delusion realization understanding true nature]</code></pre>
</div>
</div>
<p>Now that our data is relatively clean, we can construct a bag of words using <code>CountVectorizer</code>.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>from sklearn.feature_extraction.text import CountVectorizer</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>import numpy as np</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="ot">=</span> <span class="fu">CountVectorizer</span>()</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>bow <span class="ot">=</span> <span class="fu">vectorizer.fit_transform</span>(text_list_clean)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see the most popular words in the corpus:</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>vectorizer.vocabulary_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wikipedia-data" class="level2">
<h2 class="anchored" data-anchor-id="wikipedia-data">Wikipedia Data</h2>
<p>Next, let’s clean up our Wikipedia data. The Wikipedia API returned a complex nested R object. We already extracted the HTML from this R object and stored it in a csv, but we really want the main text of each webpage.</p>
<p>We will use <code>rvest</code> to “harvest” the data from each HTML and store all of the information in a tibble.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/wikipedia_scrape.Rdata"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>wiki_data <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'title'</li><li>'text'</li><li>'link'</li></ol>
</div>
</div>
<p>The HTML data is stored in the text column of the data frame. Let’s take the first element to parse out the text from each webpage.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>first <span class="ot">&lt;-</span> wiki_data<span class="sc">$</span>text[<span class="dv">1</span>]</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>first <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_element</span>(<span class="st">"body"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_element</span>(<span class="st">"div"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">"p"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Throughout exploring the structure of the HTML file in Wikipedia, we see that there is a simple way to get all paragraph text from each page. We just need to pull all the text from the <code>&lt;p&gt;</code> tags on each page.</p>
<p>Now, we will loop through the tibble to convert the HTML string into a plain text string representing the paragraphs on the Wikipedia page.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>text_column <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(wiki_data)) {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    html <span class="ot">&lt;-</span> wiki_data<span class="sc">$</span>text[i]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    text_list <span class="ot">&lt;-</span> html <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">read_html</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_element</span>(<span class="st">"body"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_elements</span>(<span class="st">"p"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_text</span>()</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    text_list <span class="ot">&lt;-</span> <span class="fu">paste0</span>(text_list, <span class="at">collapse =</span> <span class="st">" "</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    text_column <span class="ot">&lt;-</span> <span class="fu">append</span>(text_column, text_list)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have a list of all the text from each of these HTML files. Let’s add this as a new column to our tibble and get rid of the huge HTML strings to decrease our memory footprint.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>wiki_data <span class="ot">&lt;-</span> wiki_data <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>text) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">add_column</span>(<span class="at">raw_text =</span> text_column)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have our text data from Wikipedia in a data frame with labels representing whether the page was a forward or backward link for the page titled “Long-term effects of cannabis.”</p>
</section>
</section>
<section id="record-data" class="level1">
<h1>Record Data</h1>
<p>Now, we will begin the process of cleaning our record data. We will start by focusing on Setién-Suero and her data regarding the differences in the effects on cannabis on men and women <span class="citation" data-cites="Setién-Suero2017">(<a href="#ref-Setién-Suero2017" role="doc-biblioref">Setién-Suero et al. 2017</a>)</span>.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="135">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/s1file.csv"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"../data/s2file.csv"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 549 Columns: 102
-- Column specification --------------------------------------------------------
Delimiter: ","
dbl (102): Code, Program, sex, age, age_psychosis, famhis, hospita, dui, dup...

i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.
Rows: 477 Columns: 65
-- Column specification --------------------------------------------------------
Delimiter: ","
dbl (65): code, Program, sex, age, agepsychosis, fampsic, hospita, dui, dup,...

i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-display">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'Code'</li><li>'Program'</li><li>'sex'</li><li>'age'</li><li>'age_psychosis'</li><li>'famhis'</li><li>'hospita'</li><li>'dui'</li><li>'dup'</li><li>'levelsocioeco'</li><li>'urbanarea'</li><li>'livingwithparents'</li><li>'unmarried'</li><li>'unemployed'</li><li>'years_edu'</li><li>'CannabisBinary'</li><li>'joints'</li><li>'cannabisonset'</li><li>'durationcannabis'</li><li>'SAPS0'</li><li>'SANS0'</li><li>'Psychoticdim0'</li><li>'Disorganizeddim0'</li><li>'Negativedimen0'</li><li>'dasgl0'</li><li>'gaf0'</li><li>'avlla0'</li><li>'avllv0'</li><li>'avlto0'</li><li>'avllb0'</li><li>'avlvi0'</li><li>'avldi0'</li><li>'avlre0'</li><li>'comisi0'</li><li>'waisd0'</li><li>'waisdp0'</li><li>'waisdd0'</li><li>'waisdi0'</li><li>'spandir0'</li><li>'spanin0'</li><li>'gpdo0'</li><li>'gpndo0'</li><li>'gpdofinal'</li><li>'cptre0'</li><li>'cptco0'</li><li>'cptom0'</li><li>'cpter0'</li><li>'cpttr0'</li><li>'fcrco0'</li><li>'fcrri0'</li><li>'fcrrd0'</li><li>'fcrtco0'</li><li>'tmta0'</li><li>'tmtae0'</li><li>'tmtb0'</li><li>'tmtbe0'</li><li>'TMTf'</li><li>'waisvd0'</li><li>'waisv0'</li><li>'waiscnd0'</li><li>'waiscn0'</li><li>'Diagnosisobinnary'</li><li>'insight'</li><li>'dasgl3y'</li><li>'gaf3y'</li><li>'SAPS3y'</li><li>'SANS3y'</li><li>'Psychotic3y'</li><li>'disorganized3y'</li><li>'Negative3y'</li><li>'tmtb0bis'</li><li>'gpdo0bis'</li><li>'zavldi0'</li><li>'zfcrrd0'</li><li>'zwaiscn0'</li><li>'zwaisdi0'</li><li>'ztmtb0'</li><li>'zgpdo0'</li><li>'zcptco0'</li><li>'Tavldi0'</li><li>'Tfcrrd0'</li><li>'Twaiscn0'</li><li>'Twaisdi0'</li><li>'Ttmtb0'</li><li>'Tgpdo0'</li><li>'Tcptco0'</li><li>'g_Tcptco0'</li><li>'g_Tavldi0'</li><li>'g_Tfcrrd0'</li><li>'g_Twaiscn0'</li><li>'g_Twaisdi0'</li><li>'g_Ttmtb0'</li><li>'g_Tgpdo0'</li><li>'GDS'</li><li>'DEFICIT_1'</li><li>'SAPS1y'</li><li>'SANS1y'</li><li>'psychotic1y'</li><li>'diroganized1y'</li><li>'Negative1y'</li><li>'dasgl1y'</li><li>'gaf1y'</li></ol>
</div>
</div>
<p>First, let’s figure out how much missing data we have.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 1 x 102</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">Code</th>
<th data-quarto-table-cell-role="th" scope="col">Program</th>
<th data-quarto-table-cell-role="th" scope="col">sex</th>
<th data-quarto-table-cell-role="th" scope="col">age</th>
<th data-quarto-table-cell-role="th" scope="col">age_psychosis</th>
<th data-quarto-table-cell-role="th" scope="col">famhis</th>
<th data-quarto-table-cell-role="th" scope="col">hospita</th>
<th data-quarto-table-cell-role="th" scope="col">dui</th>
<th data-quarto-table-cell-role="th" scope="col">dup</th>
<th data-quarto-table-cell-role="th" scope="col">levelsocioeco</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">g_Tgpdo0</th>
<th data-quarto-table-cell-role="th" scope="col">GDS</th>
<th data-quarto-table-cell-role="th" scope="col">DEFICIT_1</th>
<th data-quarto-table-cell-role="th" scope="col">SAPS1y</th>
<th data-quarto-table-cell-role="th" scope="col">SANS1y</th>
<th data-quarto-table-cell-role="th" scope="col">psychotic1y</th>
<th data-quarto-table-cell-role="th" scope="col">diroganized1y</th>
<th data-quarto-table-cell-role="th" scope="col">Negative1y</th>
<th data-quarto-table-cell-role="th" scope="col">dasgl1y</th>
<th data-quarto-table-cell-role="th" scope="col">gaf1y</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>15</td>
<td>2</td>
<td>1</td>
<td>35</td>
<td>13</td>
<td>18</td>
<td>...</td>
<td>135</td>
<td>172</td>
<td>172</td>
<td>95</td>
<td>101</td>
<td>92</td>
<td>93</td>
<td>98</td>
<td>102</td>
<td>263</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visdat)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(s1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="data-cleaning_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>A quick visualization of our data show that there are some columns with high completeness, a some columns with larger amounts of missing data. To remedy this, we can remove the columns with large amount of missing data. Let’s remove all columns with more than 10% of data missing.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="136">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> s1 <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)) <span class="sc">&lt;</span> <span class="dv">55</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> s2 <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)) <span class="sc">&lt;</span> <span class="dv">48</span>))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">%&gt;%</span> vis_miss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="data-cleaning_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now our data has a much more acceptable amount of missing information, and we have gotten rid of some superfluous fields.</p>
<p>Next, let’s take a look at some of the binary fields. I notice that they seem to use 1 and 2 rather than the standard 0 and 1.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">n_distinct</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> . <span class="sc">&lt;=</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 1 x 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">sex</th>
<th data-quarto-table-cell-role="th" scope="col">CannabisBinary</th>
<th data-quarto-table-cell-role="th" scope="col">Diagnosisobinnary</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(sex, CannabisBinary, Diagnosisobinnary) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 8 x 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">sex</th>
<th data-quarto-table-cell-role="th" scope="col">CannabisBinary</th>
<th data-quarto-table-cell-role="th" scope="col">Diagnosisobinnary</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="137">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> s1 <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">sex =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">CannabisBinary =</span> <span class="fu">ifelse</span>(CannabisBinary <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">Diagnosisobinnary =</span> <span class="fu">ifelse</span>(Diagnosisobinnary <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also visualize the distribution of these binary values. These will demonstrate the sex, cannabis usage, and diagnosis of each participant recorded in the study data.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="138">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(sex, CannabisBinary, Diagnosisobinnary) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vis_binary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="data-cleaning_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="sc">%&gt;%</span> <span class="fu">write_csv</span>(<span class="st">"../data/s1file_clean.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that our data from Setién-Suero is relatively clean, let’s take a look at another dataset.</p>
<section id="cannabinoids" class="level2">
<h2 class="anchored" data-anchor-id="cannabinoids">Cannabinoids</h2>
<p>We can clean <span class="citation" data-cites="GIBSON2020113380">Gibson et al. (<a href="#ref-GIBSON2020113380" role="doc-biblioref">2020</a>)</span> data set on cannabinoids and their impact on individuals with psychosis. We will start again by visualizing missing data in our table.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="63">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"../data/raw_data/DataforSumbission_FINAL.xlsx"</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="sc">%&gt;%</span> <span class="fu">vis_dat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
* `` -&gt; `...1`
* `` -&gt; `...2`</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="data-cleaning_files/figure-html/cell-29-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Overall, the completeness of this data is pretty good. We again remove the columns with a high rate of incompleteness. We can also drop rows with missing data because we see a pattern where the missing data tends to collect in rows.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="96">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="ot">&lt;-</span> cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(.)) <span class="sc">&lt;</span> <span class="dv">20</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="ot">&lt;-</span> cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">na_count =</span> <span class="fu">apply</span>(., <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(na_count <span class="sc">&lt;</span> <span class="dv">20</span>) </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vis_dat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="data-cleaning_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>I notice that there seem to be a lot of character columns. Let’s check to make sure that these columns are standardized and do some cleaning up.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="102">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="ot">&lt;-</span> cannabinoid <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">...1</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="107">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>name_list <span class="ot">&lt;-</span> cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">where</span>(is.character)) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="110">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(name <span class="cf">in</span> name_list) {</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="fu">all_of</span>(name)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 1
  Group_Toxicology    
  &lt;chr&gt;               
1 Cannabinoid-Positive
2 Cannabinoid-Negative
3 119                 
# A tibble: 3 x 1
  Toxicology_Synthetic_Cannabinoid
  &lt;chr&gt;                           
1 Synthetic Cannabinoid Negative  
2 Synthetic Cannabinoid Positive  
3 119                             
# A tibble: 5 x 1
  Batch 
  &lt;chr&gt; 
1 NA    
2 DEC 17
3 MAR 18
4 JUL 18
5 107   
# A tibble: 6 x 1
  RaceEthnicity
  &lt;chr&gt;        
1 Hispanic     
2 Black        
3 White        
4 Asian        
5 Unknown      
6 119          
# A tibble: 6 x 1
  MaritalStatus               
  &lt;chr&gt;                       
1 "Single\u200e/Never married"
2  NA                         
3 "Widowed\u200e/Divorced (?)"
4 "Married"                   
5 "0"                         
6 "116"                       
# A tibble: 6 x 1
  Education               
  &lt;chr&gt;                   
1 Non-high school graduate
2 High school graduate    
3 Some college            
4 College graduate        
5 NA                      
6 114                     
# A tibble: 5 x 1
  WorkStatus 
  &lt;chr&gt;      
1 Not working
2 NA         
3 Full time  
4 Part time  
5 111        
# A tibble: 7 x 1
  LivingSituation                                                      
  &lt;chr&gt;                                                                
1 "Shelter\u200e/homeless"                                             
2  NA                                                                  
3 "Independent Housing (own\u200e/rent)"                               
4 "Other"                                                              
5 "Living with family\u200e/friend\u200e/domestic partner\u200e/spouse"
6 "Transitional Housing\u200e (SRO, residential housing)"              
7 "113"                                                                
# A tibble: 5 x 1
  LivingSit_Combined                    
  &lt;chr&gt;                                 
1 "Shelter\u200e/homeless"              
2  NA                                   
3 "Independent Housing (own\u200e/rent)"
4 "Other"                               
5 "113"                                 
# A tibble: 7 x 1
  HouseholdSupport                    
  &lt;chr&gt;                               
1  NA                                 
2 "Self-support"                      
3 "Government support (SSD\u200e/SSI)"
4 "Parental\u200e/guardian support"   
5 "Other"                             
6 "Spouse\u200e/partner support"      
7 "108"                               
# A tibble: 5 x 1
  Clinician_Admission_PANSS
  &lt;chr&gt;                    
1 AB                       
2 HE                       
3 DD                       
4 CM                       
5 119                      
# A tibble: 5 x 1
  Clinician_Discharge_PANSS
  &lt;chr&gt;                    
1 NA                       
2 HE                       
3 DD                       
4 CM                       
5 117                      
# A tibble: 6 x 1
  `Mini MDD Dx`   
  &lt;chr&gt;           
1 Past            
2 None            
3 Current and Past
4 NA              
5 Current         
6 104             
# A tibble: 6 x 1
  `Mini Mania Dx` 
  &lt;chr&gt;           
1 None            
2 Current and Past
3 NA              
4 Past            
5 Current         
6 100             
# A tibble: 3 x 1
  `Pyschotic diagnosis at discharge`
  &lt;chr&gt;                             
1 Yes                               
2 No                                
3 119                               
# A tibble: 3 x 1
  `Mood diagnosis at discharge`
  &lt;chr&gt;                        
1 No                           
2 Yes                          
3 119                          
# A tibble: 4 x 1
  `History of mood disorder`
  &lt;chr&gt;                     
1 0                         
2 Mania                     
3 Depression                
4 119                       
# A tibble: 9 x 1
  `Psychotic disoder dx at discharge` 
  &lt;chr&gt;                               
1 Psychotic Disorder NOS              
2 Schizoaffective Disorder            
3 Bipolar Disorder                    
4 Schizophrenia                       
5 MDD with Psychotic Features         
6 Substance Induced Psychotic Disorder
7 None                                
8 Other Psychotic Disorder            
9 119                                 
# A tibble: 3 x 1
  `If patient required a PRN (extra) medication for agitation in CPEP`
  &lt;chr&gt;                                                               
1 No                                                                  
2 Yes                                                                 
3 119                                                                 
# A tibble: 3 x 1
  `If patient required a PRN (extra) medication for agitation in Unit`
  &lt;chr&gt;                                                               
1 No                                                                  
2 Yes                                                                 
3 119                                                                 
# A tibble: 3 x 1
  `If patient required a PRN (extra) medication for agitation in Unit or CPEP`
  &lt;chr&gt;                                                                       
1 No                                                                          
2 Yes                                                                         
3 119                                                                         
# A tibble: 4 x 1
  SMOKER
  &lt;chr&gt; 
1 Yes   
2 No    
3 NA    
4 117   
# A tibble: 3 x 1
  Sex   
  &lt;chr&gt; 
1 Male  
2 Female
3 119   
# A tibble: 4 x 1
  `Smoker, no missing values (median)`
  &lt;chr&gt;                               
1 NA                                  
2 Yes                                 
3 No                                  
4 107                                 
# A tibble: 4 x 1
  `If patient recieved antipsychotics before study blood draw`
  &lt;chr&gt;                                                       
1 NA                                                          
2 Yes                                                         
3 No                                                          
4 113                                                         
# A tibble: 4 x 1
  `If patient recieved benzos before study blood draw`
  &lt;chr&gt;                                               
1 NA                                                  
2 Yes                                                 
3 No                                                  
4 113                                                 
# A tibble: 3 x 1
  `Medical condition known to effect cytokine levels`
  &lt;chr&gt;                                              
1 No condition                                       
2 Condition present                                  
3 119                                                
# A tibble: 4 x 1
  Cocaine 
  &lt;chr&gt;   
1 Negative
2 Missing 
3 Positive
4 119     
# A tibble: 4 x 1
  PCP     
  &lt;chr&gt;   
1 Positive
2 Negative
3 Missing 
4 119     
# A tibble: 4 x 1
  Opiates 
  &lt;chr&gt;   
1 Negative
2 Missing 
3 Positive
4 119     
# A tibble: 4 x 1
  Benzos  
  &lt;chr&gt;   
1 Negative
2 Missing 
3 Positive
4 119     
# A tibble: 4 x 1
  Barbituates
  &lt;chr&gt;      
1 Negative   
2 Missing    
3 Positive   
4 119        
# A tibble: 4 x 1
  Methadone
  &lt;chr&gt;    
1 Negative 
2 Missing  
3 Positive 
4 119      
# A tibble: 4 x 1
  Amphetamines
  &lt;chr&gt;       
1 Negative    
2 Missing     
3 Positive    
4 119         
# A tibble: 4 x 1
  Alcohol 
  &lt;chr&gt;   
1 Negative
2 Missing 
3 Positive
4 119     
# A tibble: 3 x 1
  All_Other_Tox
  &lt;chr&gt;        
1 Positive     
2 None         
3 119          
# A tibble: 56 x 1
   `Medical Conditions`                                                         
   &lt;chr&gt;                                                                        
 1 None                                                                         
 2 Hypothyroidism                                                               
 3 Pt had leukocytosis axillary abscess drained while on unit and then a short ~
 4 DM Type 2, HTN, CVA, HCV                                                     
 5 Recently post-partum                                                         
 6 AIDS                                                                         
 7 Asthma, herpes, HTN                                                          
 8 HTN                                                                          
 9 None recorded but taking asthma medications                                  
10 HIV                                                                          
# i 46 more rows
# A tibble: 3 x 1
  `Patient Discharged on First Generation Antipsychotic`
  &lt;chr&gt;                                                 
1 No                                                    
2 Yes                                                   
3 119                                                   
# A tibble: 3 x 1
  `Patient Discharged on Second Generation Antipsychotic`
  &lt;chr&gt;                                                  
1 Yes                                                    
2 No                                                     
3 119                                                    
# A tibble: 3 x 1
  `Patient Discharged on Any Antipsychotic`
  &lt;chr&gt;                                    
1 Yes                                      
2 No                                       
3 119                                      
# A tibble: 3 x 1
  `Patient Discharged on Clozapine`
  &lt;chr&gt;                            
1 No                               
2 Yes                              
3 119                              
# A tibble: 3 x 1
  `Patient Discharged on Injectable Antipsychotic`
  &lt;chr&gt;                                           
1 Yes                                             
2 No                                              
3 119                                             
# A tibble: 3 x 1
  `Patient Discharged on Mood Stabilizer`
  &lt;chr&gt;                                  
1 No                                     
2 Yes                                    
3 119                                    
# A tibble: 3 x 1
  `Patient Discharged on Antidepressant`
  &lt;chr&gt;                                 
1 No                                    
2 Yes                                   
3 119                                   
# A tibble: 3 x 1
  `Patient Discharged on Anxioytic`
  &lt;chr&gt;                            
1 No                               
2 Yes                              
3 119                              
# A tibble: 3 x 1
  `Patient Discharged on Medication to Prevent Relapse`
  &lt;chr&gt;                                                
1 No                                                   
2 Yes                                                  
3 119                                                  
# A tibble: 3 x 1
  `Patient Discharged on Benzotropine or Equivalent`
  &lt;chr&gt;                                             
1 No                                                
2 Yes                                               
3 119                                               
# A tibble: 3 x 1
  `Patient Discharged on Propanolol for Akathisia`
  &lt;chr&gt;                                           
1 No                                              
2 Yes                                             
3 119                                             
# A tibble: 3 x 1
  `Patient Discharged on Benzotropine or Propanolol`
  &lt;chr&gt;                                             
1 No                                                
2 Yes                                               
3 119                                               </code></pre>
</div>
</div>
<p>Generally, these character columns are very clean. However, I want to get rid of the encoding issue causing <code>\u200e</code> to appear.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="127">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">if_any</span>(<span class="fu">where</span>(is.character), <span class="sc">~</span><span class="fu">str_detect</span>(., <span class="st">"\u200e"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 1 x 104</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">ID</th>
<th data-quarto-table-cell-role="th" scope="col">Group_Toxicology</th>
<th data-quarto-table-cell-role="th" scope="col">Toxicology_Synthetic_Cannabinoid</th>
<th data-quarto-table-cell-role="th" scope="col">Batch</th>
<th data-quarto-table-cell-role="th" scope="col">RaceEthnicity</th>
<th data-quarto-table-cell-role="th" scope="col">MaritalStatus</th>
<th data-quarto-table-cell-role="th" scope="col">Education</th>
<th data-quarto-table-cell-role="th" scope="col">NumberChildren</th>
<th data-quarto-table-cell-role="th" scope="col">WorkStatus</th>
<th data-quarto-table-cell-role="th" scope="col">LivingSituation</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL10_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL12_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL1b_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL2_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL21_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL6_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL8_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogTNFa_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogsIL2Ra_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogCRP_scaled</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1000</td>
<td>Cannabinoid-Positive</td>
<td>Synthetic Cannabinoid Negative</td>
<td>NA</td>
<td>Hispanic</td>
<td>Single&lt;U+200E&gt;/Never married</td>
<td>Non-high school graduate</td>
<td>0</td>
<td>Not working</td>
<td>Shelter&lt;U+200E&gt;/homeless</td>
<td>...</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="133">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="ot">&lt;-</span> cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), <span class="sc">~</span><span class="fu">str_replace_all</span>(., <span class="st">"\u200e"</span>, <span class="st">""</span>)))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 1 x 104</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">ID</th>
<th data-quarto-table-cell-role="th" scope="col">Group_Toxicology</th>
<th data-quarto-table-cell-role="th" scope="col">Toxicology_Synthetic_Cannabinoid</th>
<th data-quarto-table-cell-role="th" scope="col">Batch</th>
<th data-quarto-table-cell-role="th" scope="col">RaceEthnicity</th>
<th data-quarto-table-cell-role="th" scope="col">MaritalStatus</th>
<th data-quarto-table-cell-role="th" scope="col">Education</th>
<th data-quarto-table-cell-role="th" scope="col">NumberChildren</th>
<th data-quarto-table-cell-role="th" scope="col">WorkStatus</th>
<th data-quarto-table-cell-role="th" scope="col">LivingSituation</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL10_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL12_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL1b_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL2_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL21_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL6_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogIL8_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogTNFa_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogsIL2Ra_scaled</th>
<th data-quarto-table-cell-role="th" scope="col">LogCRP_scaled</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">...</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1000</td>
<td>Cannabinoid-Positive</td>
<td>Synthetic Cannabinoid Negative</td>
<td>NA</td>
<td>Hispanic</td>
<td>Single/Never married</td>
<td>Non-high school graduate</td>
<td>0</td>
<td>Not working</td>
<td>Shelter/homeless</td>
<td>...</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>I also notice that there is one row where the values are numeric rather than character. It might be a total row or an error. Let’s get rid of that row.</p>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="112">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confirm that this is only one row</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Group_Toxicology <span class="sc">==</span> <span class="dv">119</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the row</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="ot">&lt;-</span> cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Group_Toxicology <span class="sc">!=</span> <span class="dv">119</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<div class="cell" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="134">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>cannabinoid <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(<span class="st">"../data/cannabinoid_clean.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that our data is clean, we can move on to some exploratory data analysis.</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-GIBSON2020113380" class="csl-entry" role="listitem">
Gibson, Claire L., Anahita Bassir Nia, Sharron A. Spriggs, Daniel DeFrancisco, Amy Swift, Charles Perkel, Xiaobo Zhong, et al. 2020. <span>“Cannabinoid Use in Psychotic Patients Impacts Inflammatory Levels and Their Association with Psychosis Severity.”</span> <em>Psychiatry Research</em> 293: 113380. https://doi.org/<a href="https://doi.org/10.1016/j.psychres.2020.113380">https://doi.org/10.1016/j.psychres.2020.113380</a>.
</div>
<div id="ref-Setién-Suero2017" class="csl-entry" role="listitem">
Setién-Suero, Esther, Karl Neergaard, Mariluz Ramírez-Bonilla, Patricia Correa-Ghisays, Lourdes Fañanás, Benedicto Crespo-Facorro, and Rosa Ayesa-Arriola. 2017. <span>“<span class="nocase">Cannabis use in male and female first episode of non-affective psychosis patients: Long-term clinical, neuropsychological and functional differences</span>,”</span> August. <a href="https://doi.org/10.1371/journal.pone.0183613">https://doi.org/10.1371/journal.pone.0183613</a>.
</div>
<div id="ref-tidydata" class="csl-entry" role="listitem">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>Journal of Statistical Software</em> 59 (10): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Authored by Marion Geary Bauman, 2023</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mfgeary">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/marion-geary">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>